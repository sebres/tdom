# Features covered: Structure validation
#
# Tested functionalities:
#    structure-1.*: Basics, interface
#
# Copyright (c) 2018 Rolf Ade.

source [file join [file dir [info script]] loadtdom.tcl]

test structure-1.1 {create} {
    tdom::structure create grammer
    grammer start doc
    grammer delete
} {}

test structure-1.2 {grammer cmd outside context} {
    catch {tdom::structure::element}
} {1}

test structure-1.3 {grammer cmd} {
    tdom::structure create grammer
    grammer pattern somePattern {
        element foo !
    }
    grammer delete
} {}

test structure-1.4 {grammer cmd} {
    tdom::structure create grammer
    grammer pattern somePattern {
        for {set i 0} {$i < 100} {incr i} {
            element foo$i !
        }
    }
    grammer delete
} {}

test structure-1.5 {grammer cmd} {
    tdom::structure create grammer
    grammer element doc {
        element elm1
        element elm2 *
    }
    grammer element elm1 empty
    grammer element elm2 empty
    grammer delete
} {}

test structure-1.6 {quants} {
    tdom::structure create grammer
    grammer element doc {
        element elm1
        element elm2 *
        element elm3 !
        element elm4 +
        element elm5 ?
        element elm6 1
        element elm7 5
        element elm8 12
        element elm9 {0 3}
        element elm9 {1 12}
        element elm10 "8 "
    }
    grammer delete
} {}

test structure-1.7 {quants} {
    tdom::structure create grammer
    grammer element doc {
        for {set i 0} {$i < 100} {incr i} {
            element elm$i [list $i [expr {$i + 1}]]
        }
    }
    grammer delete
} {}

test structure-2.1 {grammer definition: ref} {
    tdom::structure create grammer
    grammer pattern thisPattern {
        element a
        element b
    }
    grammer pattern thatPattern {
        element c
        element d
    }
    grammer element doc {
        ref thisPattern
        ref thatPattern ?
    }
    grammer delete
} {}

test structure-2.2 {grammer definition: ref} {
    tdom::structure create grammer
    set result [grammer nrForwardDefinitions]
    grammer element doc {
        ref thisPattern
        ref thatPattern ?
    }
    lappend result [grammer nrForwardDefinitions]
    grammer delete
    set result
} {0 2}

test structure-3.1 {grammer definition: choice} {
    tdom::structure create grammer
    grammer element doc {
        element elm
        choice {
            element fooElem
            element barElem +
        }
        choice ? {
            element one {2 3}
            element two
        }
        element three
    }
    grammer delete
} {}

test structure-3.2 {grammer definition: choice} {
    tdom::structure create grammer
    grammer pattern thisPattern {
        element elm
        choice {
            element fooElem
            element barElem +
        }
        choice ? {
            element one {2 3}
            element two
        }
        element three
    }
    grammer delete
} {}
